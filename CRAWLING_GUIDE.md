# 크롤링 가이드

## ⚠️ 주의사항

크롤링을 실행하기 전에 반드시 확인하세요:

1. **법적 문제**: VeryPay 웹사이트의 이용약관을 확인하세요
2. **개인정보 보호**: 수집된 데이터의 저장 및 사용에 주의하세요
3. **서버 부하**: 과도한 요청으로 서버에 부담을 주지 마세요
4. **책임**: 크롤링으로 인한 모든 법적 책임은 사용자에게 있습니다

## 📋 필수 조건

### 1. Node.js 설치
Node.js 18 이상이 필요합니다.

### 2. 의존성 설치
```bash
npm install
```

## 🚀 크롤링 실행

### 1단계: 크롤링 스크립트 실행

```bash
npm run crawl
```

### 실행 과정
1. ✅ Puppeteer 브라우저 실행
2. ✅ VeryPay 상점 페이지 접속
3. ✅ "더보기" 버튼을 자동으로 클릭 (최대 628개 데이터 로드)
4. ✅ 모든 상점 데이터 수집
5. ✅ 중복 제거
6. ✅ 국가/시도/시군구 파싱
7. ✅ `data/shops.json` 파일로 저장

### 예상 소요 시간
- 약 3~5분 (네트워크 속도에 따라 다름)
- 628개 상점 기준

### 2단계: 데이터 복사

크롤링이 완료되면 데이터를 웹앱에서 사용할 수 있도록 복사합니다:

#### Windows
```bash
copy data\shops.json public\data\shops.json
```

#### Mac/Linux
```bash
cp data/shops.json public/data/shops.json
```

### 3단계: Git에 커밋

```bash
git add public/data/shops.json
git commit -m "Update: 크롤링 데이터 업데이트 (628개 상점)"
git push
```

## 📊 크롤링 결과 확인

크롤링 실행 시 다음과 같은 정보를 확인할 수 있습니다:

```
🚀 크롤링 시작...
📄 페이지 로딩 중...
📥 "더보기" 버튼 클릭 중...
   1번째 더보기 클릭...
   2번째 더보기 클릭...
   ...
📊 총 15번 더보기 클릭 완료
✅ 628개의 상점 데이터 수집 완료
🔍 중복 제거 후: 620개
💾 데이터 저장 완료: C:\...\verymap\data\shops.json
📊 총 620개 상점

📈 통계:
- 국가: 15개
- 카테고리: 13개
```

## 🔧 트러블슈팅

### 오류: "더보기 버튼을 찾을 수 없습니다"
- 웹사이트 구조가 변경되었을 수 있습니다
- `scripts/crawl.ts` 파일의 선택자를 수정해야 합니다

### 오류: "Puppeteer 실행 실패"
- Chrome/Chromium이 제대로 설치되지 않았을 수 있습니다
- 다시 설치 시도:
  ```bash
  npm install puppeteer --force
  ```

### 수집된 데이터가 적음
- 네트워크 연결을 확인하세요
- 페이지 로딩 시간을 늘려보세요 (`waitForTimeout` 값 증가)
- 웹사이트가 접근을 차단했을 수 있습니다

### 한국 주소가 제대로 파싱되지 않음
- `parseAddress` 함수의 로직을 확인하세요
- 새로운 주소 형식이 추가되었다면 패턴을 추가하세요

## 🔄 정기적인 업데이트

데이터를 최신 상태로 유지하려면:

1. 주기적으로 크롤링 실행 (예: 주 1회)
2. 데이터 비교 후 변경사항만 커밋
3. Vercel에서 자동 재배포됨

## 📝 데이터 구조

```json
{
  "name": "상점 이름",
  "address": "전체 주소",
  "category": "카테고리",
  "veryPrice": "VERY 단가",
  "paymentRatio": "결제 비율",
  "country": "국가",
  "state": "시/도",
  "city": "시/군/구"
}
```

## 🛠️ 커스터마이징

### 더보기 클릭 횟수 조정
`scripts/crawl.ts` 파일에서:
```typescript
// 최대 50번 → 원하는 숫자로 변경
if (clickCount >= 50) {
```

### 대기 시간 조정
네트워크가 느린 경우:
```typescript
// 2000ms → 3000ms 또는 4000ms로 증가
await page.waitForTimeout(2000);
```

### 추가 국가 지원
`parseAddress` 함수에 새로운 국가 로직 추가

## 📞 문제 발생 시

1. GitHub Issues에 문제 보고
2. 에러 메시지 전체 복사
3. 실행 환경 정보 포함 (OS, Node.js 버전 등)
